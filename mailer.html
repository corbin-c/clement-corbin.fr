<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <title>Contact Form Example</title>
</head>

<body>
  <h2>Contact Me!</h2>
  <aside>
       <p>
           I would <em>love</em> to hear from you! </p>
           <p>Please use the <b><em>Contact Form</em></b>
           to send me a message.
       </p>
   </aside>

  <form id="contact_form" method="POST" action="https://script.google.com/macros/s/AKfycbwsHwTSeBPwl5jwpKk1qpX9hL1h9UY7UCwt8Anw0w/exec">

        <label for="name">Name: </label>
        <input id="name" name="name" placeholder="John Doe" required />

        <label for="message">Message: </label>
        <textarea id="message" name="message" rows="10"
        placeholder="How can I help you?" required></textarea>

        <label for="email">Your Email Address:</label>
        <input id="email" name="email" type="email" value=""
        required placeholder="your.name@email.com"/>
      <div class="g-recaptcha" data-size="compact" data-sitekey="6LfsBFkaAAAAACb8iUlwMrlf23TsxTcSanHBTEYu"></div>
      <input type="submit" id="submitbutton" value="Send" />

    <div class="thankyou_message" style="display:none;">
      <h2><em>Thanks</em> for contacting me!
        I'll get back to you soon!</h2>
    </div>


  </form>

  <script>
(() => {
  // get all data in form and return object
  let getFormData = () => {
    let formData = {
      name: document.querySelector("#name").value,
      message: document.querySelector("#message").value,
      email: document.querySelector("#email").value
    }
    formData.formDataNameOrder = JSON.stringify(["name","message","email"]);
    formData.formGoogleSheetName = "responses";
    formData.captcha = grecaptcha.getResponse();
    console.log(formData);
    return formData;
  }

  let handleFormSubmit = (event) => {  // handles form submit without any jquery
    event.preventDefault();           // we are submitting via xhr below
    let form = event.target;
    let data = getFormData();
    //add form verification
    form.querySelector("#submitbutton").disabled = true;
    //var url = form.action;
    //var xhr = new XMLHttpRequest();
    /*xhr.open('POST', url);
    // xhr.withCredentials = true;
    xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    xhr.onreadystatechange = function() {
        if (xhr.readyState === 4 && xhr.status === 200) {
          form.reset();
          var formElements = form.querySelector(".form-elements")
          if (formElements) {
            formElements.style.display = "none"; // hide form
          }
          var thankYouMessage = form.querySelector(".thankyou_message");
          if (thankYouMessage) {
            thankYouMessage.style.display = "block";
          }
        }
    };*/
    // url encode form data for sending as post data
    let encoded = Object.keys(data).map(function(k) {
        return encodeURIComponent(k) + "=" + encodeURIComponent(data[k]);
    }).join('&');
    console.log(encoded);
//    xhr.send(encoded);
  }

  document.addEventListener(
    "DOMContentLoaded",
    () => {
      document
        .querySelector("#contact_form")
        .addEventListener("submit", handleFormSubmit, false);
    },
    false);
    
})();  
  </script>
</body>
</html>
